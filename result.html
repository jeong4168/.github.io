grid: { display: false }<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>태양광 발전량 계산 결과</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
    background: #f8fafc;
    margin: 0;
    padding: 20px; 
  }
  .container {
    max-width: 90%;
    width: 100%;
    margin: auto;
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
  }

  /* 요약표 */
  .summary-box {
    background:#f5f8ff;
    border:1px solid #cdd8f0;
    border-radius:10px;
    padding:10px 15px;
    max-width: 100%;
    width: 100%;
    font-size: 13px;
    box-shadow:0 2px 8px rgba(0,0,0,0.05);
  }
  .summary-box h2 {
    text-align:center;
    color:#1d3557;
    font-size:16px;
    margin-bottom: 8px;
  }
  .summary-box table { width:100%; border-collapse:collapse; }
  .summary-box th {
    background:#e8f0fe;
    color:#1d3557;
    text-align:left;
    padding:5px 8px;
    border-bottom:1px solid #dce2ff;
    font-weight:600;
    width:55%;
  }
  .summary-box td {
    text-align:right;
    padding:5px 8px;
    border-bottom:1px solid #edf0ff;
    color:#333;
    font-weight:500;
  }
  .summary-box tr:last-child th,
  .summary-box tr:last-child td { border-bottom:none; }

  /*  돌아가기 버튼 (GeoMedrix 톤) */
  .back-btn {
    display:block;
    margin: 15px auto 0 auto;
    background:#1d3557;
    color:white;
    border:none;
    border-radius:6px;
    padding:9px 20px;
    font-size:13px;
    font-weight:600;
    cursor:pointer;
    transition:0.3s;
  }
  .back-btn:hover { background:#0f223a; }

  /* 그래프 영역 */
  .chart-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    flex-grow: 1;
    min-width: 100%;
  }
  .chart-card {
    background: white;
    border-radius: 14px;
    padding: 10px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.05);
  }
  .chart-card h3 {
    text-align:center;
    color:#1d3557;
    font-size:14px;
    margin-bottom: 4px;
  }
  .chart-card canvas {
    height: 18vh !important; 
    max-height: 900px !important;
    width: 100% !important;
  }

  /* 모바일 대응 */
  @media (max-width: 470px) {
    .container {
      flex-direction: column;
      gap: 15px;
    }
    .chart-card canvas { height: 20vh !important; }
  }
</style>
</head>
<body>
<div class="container">
  <div class="summary-box">
    <h2>발전량 시뮬레이션 결과</h2>
    <table id="summaryTable"></table>

    <!-- 계산기로 돌아가기 버튼 -->
    <button class="back-btn" onclick="location.href='calc.html'">← 계산기로 돌아가기</button>
  </div>

  <div class="chart-container">
    <div class="chart-card">
      <h3>월별 발전량 (kWh)</h3>
      <canvas id="monthlyChart"></canvas>
    </div>

    <div class="chart-card">
      <h3>월별 매출액 (원)</h3>
      <canvas id="revenueChart"></canvas>
    </div>

    <div class="chart-card">
      <h3>20년 누적 수익 (원)</h3>
      <canvas id="accumChart"></canvas>
    </div>
  </div>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const site = urlParams.get('site');
const width = parseFloat(urlParams.get('width'));
const height = parseFloat(urlParams.get('height'));
const power = parseFloat(urlParams.get('power'));
const invest = parseFloat(urlParams.get('invest')) || 0;
const support = parseFloat(urlParams.get('support')) || 0;

const siteData = {
  "산업단지": {
    area: 7718419,
    irradiance: {
      "1월": 36.1168, "2월": 55.6968, "3월": 94.7830,
      "4월": 126.1139, "5월": 155.1006, "6월": 159.8903,
      "7월": 160.2927, "8월": 140.2319, "9월": 104.5271,
      "10월": 71.3669, "11월": 41.0833, "12월": 30.1366
    }
  },
  "주차장": {
    area: 241197,
    irradiance: {
      "1월": 28.6013, "2월": 45.5446, "3월": 81.5032,
      "4월": 113.3511, "5월": 143.1436, "6월": 148.7306,
      "7월": 148.9295, "8월": 116.4261, "9월": 92.3191,
      "10월": 60.2785, "11월": 33.2715, "12월": 23.7878
    }
  },
  "철도 유휴부지": {
    area: 72040,
    irradiance: {
      "1월": 29.0993, "2월": 48.1443, "3월": 86.1475,
      "4월": 117.5718, "5월": 146.5722, "6월": 151.8027,
      "7월": 151.8509, "8월": 131.4686, "9월": 96.0437,
      "10월": 63.0325, "11월": 33.9140, "12월": 23.6004
    }
  }
};

const SMP = [137.91,119.49,134.4,125.9,126.35,125.99,132.46,145.79,138.78,117.2,112.26,116.58];
const REC = [77939,79323,79058,75584,74466,74916,75801,78753,79282,76866,75010,67159];
const pricePerKwh = 163;

const siteObj = siteData[site] || {};
const area = siteObj.area || 0;
const irradiance = siteObj.irradiance || {};
const panelArea = (width/1000)*(height/1000) || 0;
const moduleCount = panelArea > 0 ? Math.floor(area / panelArea) : 0;
const totalKW = moduleCount * (power/1000) || 0;

const months = Object.keys(irradiance);
const irradianceVals = Object.values(irradiance);
const monthlyEnergy = irradianceVals.map(val => Math.round(totalKW * val));
const monthlyRevenue = monthlyEnergy.map((val, i) => Math.round(val * (SMP[i] + (REC[i]/1000))));
const annualEnergy = monthlyEnergy.reduce((a,b)=>a+b,0);
const saving = Math.round(annualEnergy * pricePerKwh);
const breakeven = invest - support;
const yearlyRevenue = monthlyRevenue.reduce((a,b)=>a+b,0);
const accumRevenue = Array.from({length:20},(_,i)=> (yearlyRevenue*(i+1)));

document.getElementById("summaryTable").innerHTML = `
  <tr><th>선택된 부지</th><td>${site || '-'}</td></tr>
  <tr><th>발전 가능 면적</th><td>${area ? area.toLocaleString() + ' ㎡' : '-'}</td></tr>
  <tr><th>모듈 수</th><td>${moduleCount ? moduleCount.toLocaleString() + ' 개' : '-'}</td></tr>
  <tr><th>총 발전용량</th><td>${totalKW ? totalKW.toLocaleString(undefined,{maximumFractionDigits:1}) + ' kW' : '-'}</td></tr>
  <tr><th>예상 연간 발전량</th><td>${annualEnergy ? annualEnergy.toLocaleString() + ' kWh' : '-'}</td></tr>
  <tr><th>절감 전기요금</th><td>${saving ? saving.toLocaleString() + ' 원/년' : '-'}</td></tr>
  <tr><th>손익분기점</th><td>${breakeven ? breakeven.toLocaleString() + ' 원' : '-'}</td></tr>
`;

const commonOpts = {
  responsive: true,
  maintainAspectRatio: false,
  plugins: {
    tooltip: { enabled: true, callbacks: { label: ctx => ctx.raw.toLocaleString() } },
    legend: { display: false }
  },
  scales: {
    x: { 
      ticks: { autoSkip: false, maxRotation: 0, minRotation: 0, font: { size: 10 } },
      grid: { display: false }   
    },
    y: { 
      beginAtZero: true,
      ticks: { callback: v => v.toLocaleString(), font: { size: 10 } },
      grid: { display: false }   
    }
  }
};

const navy = "#1d3557";
const green = "#4caf50";
const sky = "#e8f0fe";
const orange = "#f4a261";

/* 월별 발전량 */
new Chart(document.getElementById("monthlyChart"), {
  type: 'bar',
  data: { 
    labels: months, 
    datasets: [{
      data: monthlyEnergy,
      backgroundColor: navy,
      barPercentage:0.6,
      categoryPercentage:0.7
    }]
  },
  options: { ...commonOpts }
});

/* 월별 매출액 */
new Chart(document.getElementById("revenueChart"), {
  type: 'bar',
  data: { 
    labels: months, 
    datasets: [{
      data: monthlyRevenue,
      backgroundColor: orange,
      barPercentage:0.6,
      categoryPercentage:0.7
    }]
  },
  options: { ...commonOpts }
});

/* 20년 누적 수익 */
new Chart(document.getElementById("accumChart"), {
  type: 'bar',
  data: { 
    labels: Array.from({length:20},(_,i)=>`${i+1}년`), 
    datasets: [
      { 
        label:'누적 수익',
        data: accumRevenue,
        backgroundColor: '#4caf50',
        barPercentage:0.6,
        categoryPercentage:0.7,
        order: 1 
      },
      { 
        label:'손익분기점',
        data: Array(20).fill(breakeven),
        type: 'line',
        borderColor: '#1d3557',
        borderDash: [6,4],
        borderWidth: 2,
        pointRadius: 0,
        order: 2 
      }
    ]
  },
  options: {
    ...commonOpts,
    scales: {
      x: { 
        ticks: { 
          autoSkip: false, 
          maxRotation: 0, 
          minRotation: 0, 
          font: { size: 10 }, 
          callback: (v,i)=> i%2===0 ? v+1+'년':'' 
        },
        grid: { display: false }  
      },
      y: { 
        beginAtZero: true,
        ticks: { callback: v => v.toLocaleString(), font: { size: 10 } },
        grid: { display: false }  
      }
    },
    plugins: { 
      tooltip: { 
        enabled: true, 
        callbacks: { label: ctx => ctx.raw.toLocaleString() + ' 원' } 
      },
      legend: { display: false }
    }
  }
});

</script>
</body>
</html>





